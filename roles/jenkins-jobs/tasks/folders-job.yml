- name: check if directory exists
  shell: "{{JENKINS_CLI_PREFIX}} get-job {{item.name}}"
  ignore_errors: true
  register: check_dir

- name: update directory template
  template:
    src: folder-template.xml
    dest: /tmp/folder-template.xml

- name: Create a directory & Fecth dir
  block:
    - name: Create a directory
      #when: check_dir.rc == 3
      shell: "cat /tmp/folder-template.xml | {{JENKINS_CLI_PREFIX}} create-job {{item.name}}"
      register: dir

    - name: Fetch dir name
      #when: check_dir.rc == 3
      shell: "{{dir.cmd}} | awk '{print $NF}'"
      register: foldername
  when: check_dir.rc == 3

- name: Update a directory & Fecth dir name
  block:
    - name: Update a directory
      #when: check_dir.rc == 0
      shell: "cat /tmp/folder-template.xml | {{JENKINS_CLI_PREFIX}} update-job {{item.name}}"
      register: dir

    - name: Fetch dir name
      #when: check_dir.rc == 0
      shell: "\"{{dir.cmd}}\" | awk '{print $NF}'"
      register: foldername

    - name: folder name
      debug:
        msg: "{{foldername}}"
  when: check_dir.rc == 0


